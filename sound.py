import pigpio
import time

wave = [
    50.20, 51.37, 52.55, 53.73, 54.90, 56.08, 57.25, 58.43, 
    59.61, 60.78, 61.96, 63.14, 64.31, 65.49, 66.67, 67.84, 
    69.02, 70.20, 71.37, 72.55, 73.33, 74.51, 75.69, 76.47, 
    77.65, 78.82, 79.61, 80.78, 81.57, 82.35, 83.53, 84.31, 
    85.10, 85.88, 87.06, 87.84, 88.63, 89.41, 90.20, 90.59, 
    91.37, 92.16, 92.55, 93.33, 94.12, 94.51, 94.90, 95.69, 
    96.08, 96.47, 96.86, 97.25, 97.65, 98.04, 98.43, 98.43, 
    98.82, 99.22, 99.22, 99.61, 99.61, 99.61, 99.61, 99.61, 
    99.8, 99.61, 99.61, 99.61, 99.61, 99.61, 99.22, 99.22, 
    98.82, 98.43, 98.43, 98.04, 97.65, 97.25, 96.86, 96.47, 
    96.08, 95.69, 94.90, 94.51, 94.12, 93.33, 92.55, 92.16, 
    91.37, 90.59, 90.20, 89.41, 88.63, 87.84, 87.06, 85.88, 
    85.10, 84.31, 83.53, 82.35, 81.57, 80.78, 79.61, 78.82, 
    77.65, 76.47, 75.69, 74.51, 73.33, 72.55, 71.37, 70.20, 
    69.02, 67.84, 66.67, 65.49, 64.31, 63.14, 61.96, 60.78, 
    59.61, 58.43, 57.25, 56.08, 54.90, 53.73, 52.55, 51.37, 
    50.20, 49.02, 47.84, 46.67, 45.49, 44.31, 43.14, 41.96, 
    40.78, 39.61, 38.43, 37.25, 36.08, 34.90, 33.73, 32.55, 
    31.37, 30.20, 29.02, 27.84, 27.06, 25.88, 24.71, 23.92, 
    22.75, 21.57, 20.78, 19.61, 18.82, 18.04, 16.86, 16.08, 
    15.29, 14.51, 13.33, 12.55, 11.76, 10.98, 10.20, 9.80, 
    9.02, 8.24, 7.84, 7.06, 6.27, 5.88, 5.49, 4.71, 4.31, 
    3.92, 3.53, 3.14, 2.75, 2.35, 1.96, 1.96, 1.57, 1.18, 
    1.18, 0.78, 0.78, 0.78, 0.78, 0.78, 0.39, 0.78, 0.78, 
    0.78, 0.78, 0.78, 1.18, 1.18, 1.57, 1.96, 1.96, 2.35, 
    2.75, 3.14, 3.53, 3.92, 4.31, 4.71, 5.49, 5.88, 6.27, 
    7.06, 7.84, 8.24, 9.02, 9.80, 10.20, 10.98, 11.76, 
    12.55, 13.33, 14.51, 15.29, 16.08, 16.86, 18.04, 18.82, 
    19.61, 20.78, 21.57, 22.75, 23.92, 24.71, 25.88, 27.06, 
    27.84, 29.02, 30.20, 31.37, 32.55, 33.73, 34.90, 36.08, 
    37.25, 38.43, 39.61, 40.78, 41.96, 43.14, 44.31, 45.49, 
    46.67, 47.84, 49.02, ]

pin = 26


for i, j in enumerate(wave):    # Rearrange values to pigpio DC format
    wave[i] = int(j*10000)

pi = pigpio.pi()

status = pi.hardware_PWM(26, 22000, 500000) # initiate carrier
print(status) # 0 means it worked

frequency = 440 # Note A4?
period = 1 / frequency

step = period / len(wave) # a very small number - it doesn't work
step = 0.002 # fudge it, because this makes *something* happen

try:
    cnt = 0
    t1 = time.time()
    while True:    
        for sample in wave:
            pi.hardware_PWM(26, 22000, sample)
            time.sleep(step)
        cnt += 1 # 1 cycle completed
        
except (KeyboardInterrupt, ValueError, Exception) as e:
    print(e)
    print("Aborting...")
    t2 = time.time()
    pi.hardware_PWM(26, 0, 0)     # stop the PWM output
    
print("Stopping...")
pi.hardware_PWM(26, 0, 0)     # stop the PWM output

print("{} cycles took: {} \n\n{} hz".format(cnt, t2-t1, ((t2-t1)/cnt)**-1))